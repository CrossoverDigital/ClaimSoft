@using Syncfusion.JavaScript
@using Syncfusion.MVC.EJ

@inherits CD.ClaimSoft.UI.Common.CustomViewPage<CD.ClaimSoft.Database.Model.Agency.Agency>

<div style="margin: 5px">
    @(Html.EJ().Grid<object>
        ("AgencyAddressGrid").HtmlAttributes(new { style = "min-height: 245px;" })
        .Datasource(ds => ds.Json(@Model.AgencyAddresses)
            .UpdateURL("/Administration/Administration/AgencyAddressUpdate")
            .InsertURL("/Administration/Administration/AgencyAddressInsert")
            .RemoveURL("/Administration/Administration/AgencyAddressDelete")
            .Adaptor(AdaptorType.RemoteSaveAdaptor))
          .EnableAltRow()
          .IsResponsive(true)
          .EnableAutoSaveOnSelectionChange(false)
        .EditSettings(edit =>
        {
            edit.AllowAdding()
                .AllowEditing()
                .AllowDeleting()
                .EditMode(EditMode.InlineFormTemplate)
                .InlineFormTemplateID("addressEditTemplate")
                .AllowEditOnDblClick(true);
        })
        .ToolbarSettings(tools =>
        {
            tools.ShowToolbar()
                .ToolbarItems(items =>
                {
                    items.AddTool(ToolBarItems.Add);
                    items.AddTool(ToolBarItems.Edit);
                    items.AddTool(ToolBarItems.Delete);
                });
        })
        .Columns(col =>
        {
            col.Field("Id").HeaderText("Address Id").IsPrimaryKey(true).Visible(false).Add();
            col.Field("Address1").HeaderText("Address").Width(150).Priority(1).Add();
            col.Field("City").HeaderText("City").Priority(2).Width(50).Add();
            col.Field("CountyName").HeaderText("County").Width(50).Priority(3).Add();
            col.Field("StateName").HeaderText("State").Width(50).Priority(4).Add();
            col.Field("ZipCode").HeaderText("Zip Code").Width(110).Priority(5).Add();
            col.Field("AddressType.Name").HeaderText("Address Type").Width(110).Priority(6).Add();
        })
        .ClientSideEvents(events =>
        {
            events.ActionComplete("AgencyAddressGridEditComplete");
            events.ActionBegin("AgencyAddressGridEditBegin");
        }))
</div>

<script>

    function AgencyAddressGridEditBegin(args) {
        if (args.requestType === "save")
            this.element.ejWaitingPopup("show");
    }

    function AgencyAddressGridEditComplete(args) {
        var type = args.requestType;
        if (type === "beginedit" || type === "add") {
            $("#AgencyAddressGrid_inlineFormTitle").hide();

            var selectedAddress = null;
            if (!ej.isNullOrUndefined(args.rowIndex))
                selectedAddress = this.model.currentViewData[args.rowIndex];

            this.element.ejWaitingPopup("show");

            if (type === "add") {
                $.ajax({
                    url: '@Url.Action("AgencyAddressAdd", "Administration", new {Area = "Administration"})',
                    type: "POST",
                    data: '{ agencyId: ' + $('#AgencyId').val() + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "html",
                    success: ej.proxy(function(data) {
                            var containerId = $("#" + this._id + "EditForm");

                            containerId.html(data);

                            ej.widget.init(containerId);

                            this.element.ejWaitingPopup("hide");
                        },
                        this)
                });
            } else {
                $.ajax({
                    url: '@Url.Action("AgencyAddressEdit", "Administration", new {Area = "Administration"})',
                    type: "POST",
                    data: '{ agencyAddress: ' + JSON.stringify(selectedAddress) + '}',
                    contentType: "application/json; charset=utf-8",
                    dataType: "html",
                    success: ej.proxy(function (data) {
                        var containerId = $("#" + this._id + "EditForm");

                        containerId.html(data);

                        ej.widget.init(containerId);

                        this.element.ejWaitingPopup("hide");
                    }, this)
                });
            }
        }
        if (args.requestType === "save")
            this.element.ejWaitingPopup("hide");
    }

    //# sourceURL=AgencyAddress.cshtml
</script>

@(Html.EJ().ScriptManager())